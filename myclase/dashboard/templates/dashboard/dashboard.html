{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Mis Ventas{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">Dashboard del Vendedor</h1>
            <p class="dashboard-subtitle">Visualiza tu desempe침o de ventas</p>
        </div>
    </div>

    <!-- Statistics Cards Section -->
    <div class="stats-grid">
        <!-- Aqu칤 ir칤an tus cards de estad칤sticas si los tienes -->
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section">
        <!-- Ventas por d칤a (칰ltimos 7 d칤as) -->
        <div class="chart-card">
            <div class="card-header">
                <h2>Ventas de los 칰ltimos 7 d칤as</h2>
                <span class="card-icon">游늳</span>
            </div>
            <canvas id="dailySalesChart"></canvas>
        </div>
        
        <!-- Ventas por mes -->
        <div class="chart-card">
            <div class="card-header">
                <h2>Ventas mensuales</h2>
                <span class="card-icon">游늵</span>
            </div>
            <canvas id="monthlySalesChart"></canvas>
        </div>
    </div>
    
    <!-- Data Section -->
    <div class="data-section">
        <!-- Top 5 productos -->
        <div class="data-card">
            <div class="card-header">
                <h2>Productos m치s vendidos</h2>
                <span class="card-icon">游끥</span>
            </div>
            <div class="products-list">
                {% for product in top_products %}
                <div class="datos-card product-item">
                    <div class="product-info">
                        <p class="dato-titulo">{{ product.product__title }}</p>
                        <p class="dato-detail">{{ product.total_quantity }} unidades vendidas</p>
                    </div>
                    <div class="product-price">
                        <p class="dato-precio">${{ product.total_revenue|floatformat:2 }}</p>
                    </div>
                </div>
                {% empty %}
                <p class="empty-message">No hay ventas registradas a칰n</p>
                {% endfor %}
            </div>
        </div>
        
        <!-- Transacciones recientes -->
        <div class="data-card">
            <div class="card-header">
                <h2>Transacciones recientes</h2>
                <span class="card-icon">游눱</span>
            </div>
            <div class="transactions-list">
                {% for sale in recent_transactions %}
                <div class="datos-card transaction-item transaction-{{ sale.status }}">
                    <div class="transaction-status-indicator"></div>
                    <div class="transaction-info">
                        <p class="dato-titulo">{{ sale.product.title }}</p>
                        <p class="dato-detail">
                            Cliente: <strong>{{ sale.buyer.username }}</strong> | 
                            {{ sale.quantity }} unidad{% if sale.quantity > 1 %}es{% endif %}
                        </p>
                        <p class="dato-detail-time">{{ sale.created_at|date:"d/m/Y H:i" }}</p>
                    </div>
                    <div class="transaction-right">
                        <p class="dato-precio">${{ sale.total_price|floatformat:2 }}</p>
                        <span class="status-badge status-{{ sale.status }}">
                            {{ sale.get_status_display }}
                        </span>
                    </div>
                </div>
                {% empty %}
                <p class="empty-message">No hay transacciones recientes</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Datos para ventas diarias
const dailyLabels = [{% for sale in recent_sales %}'{{ sale.date|date:"d/m" }}'{% if not forloop.last %},{% endif %}{% endfor %}];
const dailyData = [{% for sale in recent_sales %}{{ sale.total|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}];

// Gr치fico de ventas diarias
const dailyCtx = document.getElementById('dailySalesChart').getContext('2d');
new Chart(dailyCtx, {
    type: 'line',
    data: {
        labels: dailyLabels,
        datasets: [{
            label: 'Ingresos ($)',
            data: dailyData,
            borderColor: '#f56416ff',
            backgroundColor: 'rgba(245, 100, 22, 0.08)',
            tension: 0.4,
            fill: true,
            borderWidth: 3,
            pointBackgroundColor: '#f56416ff',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 5,
            pointHoverRadius: 7
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    color: '#7c7c7c',
                    font: { weight: 600 }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '$' + value;
                    },
                    color: '#7c7c7c'
                },
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                ticks: {
                    color: '#7c7c7c'
                },
                grid: {
                    display: false
                }
            }
        }
    }
});

// Datos para ventas mensuales
const monthlyLabels = [{% for sale in monthly_sales %}'{{ sale.month|date:"M Y" }}'{% if not forloop.last %},{% endif %}{% endfor %}];
const monthlyData = [{% for sale in monthly_sales %}{{ sale.total|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}];

// Gr치fico de ventas mensuales
const monthlyCtx = document.getElementById('monthlySalesChart').getContext('2d');
new Chart(monthlyCtx, {
    type: 'bar',
    data: {
        labels: monthlyLabels,
        datasets: [{
            label: 'Ingresos ($)',
            data: monthlyData,
            backgroundColor: 'rgba(119, 32, 20, 0.8)',
            borderColor: '#772014ff',
            borderWidth: 2,
            borderRadius: 8,
            hoverBackgroundColor: '#f56416ff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    color: '#7c7c7c',
                    font: { weight: 600 }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '$' + value;
                    },
                    color: '#7c7c7c'
                },
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                ticks: {
                    color: '#7c7c7c'
                },
                grid: {
                    display: false
                }
            }
        }
    }
});
</script>

{% endblock %}