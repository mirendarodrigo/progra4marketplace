{% extends "base.html" %}
{% load static %}
{% load socialaccount %}
{% block content %}
 {% if not user.is_authenticated %}
    <div class="flex-fill d-flex justify-content-center login-container">
      <div class="p-4 border rounded shadow-sm bg-light h-100 d-flex flex-column justify-content-center align-items-center text-center">

        <h2 class="fw-bold text-dark mb-3">Bienvenido a <span class="text-primary">LocalMarket</span></h2>
        <p class="fs-5 text-dark mb-4">Ingresá con:</p>
        <div class="d-flex flex-column gap-2 w-100">
          <a class="btn btn-light shadow-sm d-flex align-items-center justify-content-center" href="{% provider_login_url 'google' %}">
            <img width="24" height="24" class="me-2" src="https://img.icons8.com/color/48/google-logo.png" alt="Google"/>
            Ingresar con Google
          </a>
          
          <a class="btn btn-dark shadow-sm d-flex align-items-center justify-content-center" href="{% provider_login_url 'github' %}">
            <img width="24" height="24" class="me-2" src="https://img.icons8.com/glyph-neue/48/github.png" alt="GitHub"/>
            Ingresar con GitHub
          </a>
        </div>

      </div>
    </div>
    {% endif %} 

<div class="container py-5">
  <h2 class="text-center mb-5 fw-bold ">Ultimas Novedades!</h2>
    
  {% if products %}
    <div class="carousel-inner">
    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel"> 
      
        {% for product in products %}
        
          {% if forloop.counter0|divisibleby:4 %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
            {% endif %}
            
            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    
                    <div class="image-hover-container card-img-top carousel-card-trigger" 
                         style="height: 200px; cursor: pointer;"
                         data-title="{{ product.title }}"
                         data-price="{{ product.price|floatformat:2 }}"
                         data-brand="{{ product.marca|default:'Genérico' }}"
                         data-description="{{ product.description }}"
                         data-seller-id="{{ product.seller.id }}"
                         data-seller-name="{{ product.seller.username }}">
                       
                        {% if product.image %}
                        <img src="{{ product.image.url }}" class="object-fit-cover w-100 h-100 product-img" alt="{{ product.title }}">
                        {% else %}
                        <img src="{% static 'img/placeholder.png' %}" class="object-fit-cover w-100 h-100 product-img" alt="Sin imagen">
                        {% endif %}
                        
                        <div class="image-overlay">
                          <h5 class="card-title fw-bold text-truncate mb-1">{{ product.title }}</h5>
                          <p class="fs-4 fw-bolder text-white mb-0">${{ product.price|floatformat:2 }}</p>
                        </div>

                    </div>
                </div>
            </div>

            {% if forloop.counter|divisibleby:4 or forloop.last %}
              </div>
              </div>
            {% endif %}

        {% endfor %}
        <div class="controles">
      </div>
        </div>
        
        <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button></div>
        
       
          
    {% else %}
      <p class="text-center fs-5 text-muted">Aún no hay productos publicados en el mercadito.</p>
    {% endif %}
  </div>


<div class="container py-4">
  <div class="text-center">

    {% if user.is_authenticated %}

      <a class="btn btn-lg me-3 btn-explorar" href="{% url 'market:product_list' %}">Explorar productos</a>
      <a class="btn btn-lg btn-publicar" href="{% url 'market:add_product' %}">Publicar un producto</a>

    {% else %}
      <p class="fs-5 text-dark">Ingresá para comenzar a publicar o comprar.</p>

    {% endif %}

    </div>
</div>



    
 
  </div>
</div>



<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content product-modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="productModalLabel">Detalle del Producto</h5>
        <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div> <div class="modal-image-wrapper">
            <img id="modal-product-image" src="" class="img-fluid modal-product-img" alt="Producto">
          </div>

          <div class="modal-info-section">
            <h3 id="modal-product-title"></h3>
            <p class="text-muted mb-2"><strong>Marca:</strong> <span id="modal-product-marca"></span></p>
            <h4 class="text-primary mb-3">$<span id="modal-product-price"></span></h4>
            <p id="modal-product-description" class="mb-4"></p>

            <div class="seller-info mb-2">
              <button type="button" id="modal-seller-btn" class="btn btn-outline-secondary btn-sm w-100 text-start">
                <i class="bi bi-person-circle"></i>
                Publicado por: <span id="modal-product-seller"></span>
              </button>
            </div>
                      

            <div class="d-flex gap-2 mt-3">
              <button type="button" class="btn btn-outline-warning favorite-btn flex-grow-1" id="modal-favorite-btn">
                <i class="bi bi-star"></i> Favoritos
              </button>
              <button type="button" class="btn btn-primary cart-btn flex-grow-1" id="modal-cart-btn">
                <i class="bi bi-cart-plus"></i> Agregar al Carrito
              </button>
            </div>
          </div> </div>
      </div> </div> </div> </div> {% endblock %}