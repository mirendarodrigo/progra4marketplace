{% extends "base.html" %}
{% load static %}
{% load socialaccount %}

{% block content %}
   
<div class="container py-5">
    <h2 class="text-center mb-5 fw-bold text-primary">üõçÔ∏è Productos Recientes</h2>

    {% if products %}
    
    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
        
        <div class="carousel-inner">

            {% for product in products %}
            
            {% if forloop.counter0|divisibleby:4 %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
            {% endif %}
            
            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    
                    <div class="image-hover-container card-img-top" style="height: 200px;">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" class="object-fit-cover w-100 h-100" alt="{{ product.title }}">
                        {% else %}
                        <img src="{% static 'img/placeholder.png' %}" class="object-fit-cover w-100 h-100" alt="Sin imagen">
                        {% endif %}
                        
                        <div class="image-overlay">
                            <h5 class="card-title fw-bold text-truncate mb-1">{{ product.title }}</h5>
                            <p class="fs-4 fw-bolder text-white mb-0">${{ product.price|floatformat:2 }}</p>
                        </div>
                    </div>
                    
                  

                </div>
            </div>
            {% if forloop.counter|divisibleby:4 or forloop.last %}
                    </div> </div> {% endif %}

            {% endfor %}
            
        </div> <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>

    </div>
    </div> {% else %}
    <p class="text-center fs-5 text-muted">A√∫n no hay productos publicados en el mercadito.</p>
    {% endif %}
</div>


<div class="container py-4">

    <div class="text-center">

        {% if user.is_authenticated %}

          <a class="btn btn-primary btn-lg me-3" href="{% url 'market:product_list' %}">Explorar productos</a>

          <a class="btn btn-outline-secondary btn-lg" href="{% url 'market:add_product' %}">Publicar un producto</a>

        {% else %}

          <p class="fs-5 text-dark">Ingres√° para comenzar a publicar o comprar.</p>

        {% endif %}

    </div>

</div>





<div class="container py-5">

  <div class="d-flex flex-column flex-lg-row align-items-stretch gap-5">



    <div class="flex-fill carrusel-container">

      <div id="infoCarousel" class="carousel slide h-100" data-bs-ride="carousel">

        <div class="carousel-inner h-100">



          <div class="carousel-item active h-100 position-relative">

            <img src="{% static 'img/facilidad.png' %}" class="d-block w-100 h-100 object-fit-cover" alt="F√°cil de usar">

            <div class="carousel-caption d-flex flex-column justify-content-center align-items-center h-100">

              <h3 class="fw-semibold bg-dark bg-opacity-50 px-3 py-2 rounded">F√°cil de usar</h3>

              <p class="bg-dark bg-opacity-50 px-3 py-2 rounded">Public√° productos en minutos y encontr√° lo que busc√°s r√°pidamente.</p>

            </div>

          </div>



          <div class="carousel-item h-100 position-relative">

            <img src="{% static 'img/seguridad.png' %}" class="d-block w-100 h-100 object-fit-cover" alt="Confiable">

            <div class="carousel-caption d-flex flex-column justify-content-center align-items-center h-100">

              <h3 class="fw-semibold bg-dark bg-opacity-50 px-3 py-2 rounded">Confiable</h3>

              <p class="bg-dark bg-opacity-50 px-3 py-2 rounded">Autenticaci√≥n segura con Google o GitHub.</p>

            </div>

          </div>



          <div class="carousel-item h-100 position-relative">

            <img src="{% static 'img/gratis.png' %}" class="d-block w-100 h-100 object-fit-cover" alt="100% gratuito">

            <div class="carousel-caption d-flex flex-column justify-content-center align-items-center h-100">

              <h3 class="fw-semibold bg-dark bg-opacity-50 px-3 py-2 rounded">100% gratuito</h3>

              <p class="bg-dark bg-opacity-50 px-3 py-2 rounded">Sin costos ocultos, solo conecta y comercia.</p>

            </div>

          </div>



        </div>



        <button class="carousel-control-prev custom-carousel-btn" data-bs-target="#infoCarousel" data-bs-slide="prev">

          <span class="carousel-control-prev-icon"></span>

        </button>

        <button class="carousel-control-next custom-carousel-btn" data-bs-target="#infoCarousel" data-bs-slide="next">

          <span class="carousel-control-next-icon"></span>

        </button>

      </div>

    </div>



    <div class="flex-fill d-flex justify-content-center login-container">

      <div class="p-4 border rounded shadow-sm bg-light h-100 d-flex flex-column justify-content-center align-items-center text-center">

        {% if not user.is_authenticated %}

          <h2 class="fw-bold text-dark mb-3">Bienvenido a <span class="text-primary">LocalMarket</span></h2>

          <p class="fs-5 text-dark mb-4">Ingres√° con:</p>

          <div class="d-flex flex-column gap-2 w-100">

            <a class="btn btn-light shadow-sm d-flex align-items-center justify-content-center" href="{% provider_login_url 'google' %}">

              <img width="24" height="24" class="me-2" src="https://img.icons8.com/color/48/google-logo.png" alt="Google"/>

              Ingresar con Google

            </a>

            <a class="btn btn-dark shadow-sm d-flex align-items-center justify-content-center" href="{% provider_login_url 'github' %}">

              <img width="24" height="24" class="me-2" src="https://img.icons8.com/glyph-neue/48/github.png" alt="GitHub"/>

              Ingresar con GitHub

            </a>

          </div>

        {% else %}

          <h2 class="fw-bold text-dark mb-3">¬°Hola, {{ user.username|default:"usuario" }}!</h2>

          <p class="fs-5 text-dark">Explora o publica nuevos productos f√°cilmente.</p>

        {% endif %}

      </div>

    </div>



  </div>

</div>





{% for product in products %}

<div class="modal fade" id="productModal{{ product.id }}" tabindex="-1" aria-labelledby="productModalLabel{{ product.id }}" aria-hidden="true">

  <div class="modal-dialog modal-lg modal-dialog-centered">

    <div class="modal-content">

     

      <div class="modal-header">

        <h5 class="modal-title" id="productModalLabel{{ product.id }}">{{ product.title }}</h5>

        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>

      </div>

     

      <div class="modal-body">

        <div class="row">

         

          <div class="col-md-5">

            {% if product.image %}

                <img src="{{ product.image.url }}" class="img-fluid rounded-3" alt="{{ product.title }}">

            {% else %}

                <img src="{% static 'img/placeholder.png' %}" class="img-fluid rounded-3" alt="Sin imagen">

            {% endif %}

          </div>

         

          <div class="col-md-7">

            <p class="fs-4 fw-bolder text-success">${{ product.price|floatformat:2 }}</p>

           

            <p><strong>Marca:</strong> {{ product.marca }}</p>

            <p><strong>Vendedor:</strong> {{ product.seller.username }}</p>

            <hr>

            <h6 class="fw-bold">Descripci√≥n</h6>

            <p>{{ product.description|default:"Este producto no tiene una descripci√≥n detallada." }}</p>

            <p class="text-muted"><small>Stock disponible: {{ product.stock }}</small></p>



            <button class="btn btn-warning w-100 mt-3 disabled" title="Funcionalidad de compra no implementada">

                Comprar / Contactar

            </button>

          </div>

        </div>

      </div>

     

      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>

      </div>

    </div>

  </div>

</div>

{% endfor %}





{% endblock %}

